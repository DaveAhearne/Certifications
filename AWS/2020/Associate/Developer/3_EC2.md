# Beginners Guide to EC2 (Elastic Compute Cloud)

## EC2 101
Elastic Compute Cloud or EC2 is a web service that **provides virtual machines on demand in the cloud** meaning you can get new machines in minutes rather than the days and weeks of ordering physical hardware in the days of old

You can scale in two major ways with EC2:
* Horizontally - By spinning up new instances of EC2 to deal with load
* Vertically - By changing their type to give them access to more performant hardware

EC2 changes the game in terms of economics *you pay for what you need right now* rather than going out and making a big capex purchase all in one go including what you assume potential future use will be *(Prevents Overprovisioning)*

### Pricing Options
There are few different ways of paying for EC2 depending on how much stability you want, these are:
* On Demand - You pay a fixed rate by the hour/second and *you don't make any commitments in terms of time or use*
* Reserved - Reserves capacity for you, you enter into a contract with Amazon about how long you will keep the EC2 around for and in exchange you get a discount depending on the length of the contract of 1 to 3 years with a variable amount upfront *(Longer term = greater discount)*
* Spot - You bid on instance capacity like a stock market, if your workload supports this kind of flexibility in terms of being able to be turned on/off randomly but you want to save money this is a good option **however there is no guarantee that your workload will be run if your bid price is too low**
* Dedicated Hosts - A physical EC2 server that is dedicated for your use, these are typically used to conform to existing server-bound licence agreements for software

Windows instances are typically priced by the hour, Linux instances are typically by the second *however this may change*

On-Demand is typically good for users that want *flexibility* who *dont want long term costs* or support so things like running up a lot of machines for testing something *that can't be stopped or interrupted* or prototyping building software for example

Reserved is good if you have *long term stable load* this makes it good for things like a stock of *base web servers* with extra being on demand to cope with spikey load for example. Entering into a contract means that you *can reduce your overall cost for the length of the contract* - You can also have convertible reserved instance meaning that *you can change attributes of the virtual machine, as long as it results in the creation of an instance of equal or greater value* e.g. A very CPU intensive machine to a very memory intensive machine. With reserved you can also have **Sheduled Reserved Instances** where you reserve machines *for a specific time window* for example a holiday week/day or particular event such as the World Cup

Spot instances are *for applications that can have variable start and end times*, typically for tasks that can be broken up into very small scale steps that can be started and stopped whenever. This is typically *for applications that are only feasible at very low compute costs* e.g. Genomics, Pharmaceutical companies, Chemical companies, Bitcoin mining at 3am on a Sunday morning

**If a spot instance is terminated by EC2, you are NOT charged for the partial hour - If you terminate the instance yourself you will be charged for the complete hour**

Dedicated hosts are typically used for *regulatory requirements or licencing agreements for software* where you pay by the server, or you want to garentee your own hardware *to prevent noisy neighbours stealing your I/O* or for *legal reasons e.g. not being allowed to use multi-tenant virtualization*, it **can be purchased on demand, or as a reservation**

### EC2 Instance Types
You **do not** need to memorize all of these for the associate exams (Some of the higher tier ones you may do depending on specialization), but there are a few that are typically used fairly often

**The number next to the letter refers to the generation, the letter refers to the type**, you won't ever be tested on the generation of the machines, just their types

| Family | Speciality                    | Use Case                                                           |
|--------|-------------------------------|--------------------------------------------------------------------|
| F1     | Field Programmable Gate Array | Genomics Research, financial analytics, real time video processing |
| I3     | High speed storage            | NoSQL DBs, DBs, Data wharehousing                                  |
| G3     | Graphics intensive            | Video encoding/3D application streaming                            |
| H1     | High disk throughput          | MapReduce, distributed filesystems like HDFS                       |
| T2     | Lowest cost, general purpose  | Web server and small databases                                     |
| D2     | Dense storage                 | Fileservers, Data wharehousing, Hadoop                             |
| R4     | Memory optimized              | Memory intensive apps or databases                                 |
| M5     | General purpose               | Application servers                                                |
| C5     | Compute optimized             | CPU intensive applications or databases                            |
| P3     | Graphics/General purpose GPU  | Machine learning or Bitcoin Mining                                 |
| X1     | Memory Optimized              | SAP HANA, Apache Spark, etc.                                       |

A good mnemonic for remembering them is FIGHT DR MC PX, imagine fighting a scottish doctor that wants to give you photos of his holiday

### EBS (Elastic Block Storage)

EBS or **Elastic Block Storage is Amazon's equivalent of virtual hard disks**, you can treat these as normal hard disks in terms of creating a filesystem on then, running a database etc. You use them by *attaching them to an EC2 Instance*, **EBS Volumes get spread across an Availability Zone and replicated to prevent you from losing data due to a hardware failure**

The EBS that is attached to your EC2 instance where the operating system is installed is called the **root device volume**, but you can add other drives on top of that one

The types of EBS volumes are:
* General Purpose SSD (GP2) - Middle of the road cost/performance SSD, *3 IOPS per GB up to 10,000* and burst to 3000 IOPS for drives larger than 3.3TB
* Provisioned IOPS SSD (IO1) - For I/O intensive applications e.g. databases, *to be used if you need more than 10,000 IOPS*, can provision *up to 20,000 IOPS*
* Throughput Optimized HDD (ST1) - Magnetic Non-SSD, used for big data/data wharehousing/log processing etc, **Cannot be a boot volume/root device volume**
* Cold HDD (SC1) - Magnetic Non-SSD, Lowest cost for infrequently accessed workloads, used for a file server, **Cannot be a boot volume/root device volume**
* Magnetic (Standard) - Magnetic Non-SSD, *Lowest cost of all EBS volumes*, good for a cost critical design on an infrequently accessed workload **Is the only bootable magnetic EBS type, however its a legacy type**

## EC2 Lab

The first thing you'll want to do before you start creating EC2's and other resources is to go to the top right hand corner of the AWS Console and *change the region to something thats geographically close to you* in order to reduce latency. *If you want the latest features do your work in N.Virginia*, however bear in mind that **different reigeons may have different prices for services**

### To set up a basic EC2 instance
1. Go to the EC2 dashboard from the AWS Console
2. Click the "Launch Instance" button

Instances are created from **Amazon Machine Images** or AMI's, these are a bunch of different disk images loaded with various operating systems and some are pre-loaded with software set up and configured for you, *some of them cost money in licencing whereas others are free to use*

The main list are the images that Amazon themselves maintain, however if you look on the tab to the left hand side you will see **AWS Marketplace** and **Community AMI's** these are third party AMI's and Community submitted AMI's that you can choose that may incur a cost

3. Choose the Amazon Linux AMI - This is an image created by Amazon that includes some basic tooling on a linux environment that is free to use from a licencing perspective

4. Choose the instance type - This is when we choose what instance family we want to use from the letters from before to suit our workload

5. Configure the instance details - Here we change details about *how* the EC2 will run such as details about enabling spot pricing, how many instances you want to spin up, networking details for the machine, IAM roles it should run under etc.

6. Select any extra storage we'd like to add - Here at the top we can see and change our root device volume to any one of the other bootable types or change its size, we can also add additional drives with "Add New Volume"

7. Add tags - Tags are an optional step that lets you tag your resources with details that help organise and view them later on so you can ask questions like "What resources is this project using?", "How many EC2's has the dev team created?"

8. Configure Security Groups - **Security groups are a virtual firewall** in that on top of the existing virtual network protection we can also define rules that say what services can talk inbound or outbound to our machine on what ports, *You can also restrict the ports by IP access to certain ranges or just your IP*

9. Press Review and launch, make sure that you're happy and then click "Launch"

10. You will be prompted to create a key pair or select an existing one - This is the **public/private key set that will be used to connect to the running EC2 instance** this means that *only you with the private key can connect to this EC2 instance*, give the key pair a name if creating one and download the key pair **STORE THIS SECURELY, ANYONE WHO OBTAINS THIS PRIVATE KEY CAN LOG ONTO THE SERVER IF THE PORTS ALLOW IT**

*Remember: With public/private key auth, you can hand out your public key to anyone, but always keep the private key safe*

11. Hit launch instance to create the instance with the private key set and configuration parameters we defined

### Managing a basic EC2 instance

After we've created our EC2 instance, if we go to the instances tab on the left hand side we will be able to see a row in the table for our instance creating, it will be in the state of *"pending"* until it's finished booting up at which point it will become *"active"* and we can connect to it

To connect to the running EC2 instance via SSH:
1. Go to the instances list on the left hand side of the EC2 homepage
2. Select which instance you'd like to connect to
3. Click the connect button next to launch instance at the top of the screen
4. Choose "A standalone SSH client"
5. Follow the on-screen instructions and provide the .pem file you created when initializing the EC2 instance to securely connect to the machine

Typically, if you've just created an EC2 server - You will want to patch it with the latest updates before you start using it, to do that connect to it via SSH as above and if you're using the AWS Amazon Linux AMI run the following command:
```
    yum update -y
```

This will update all of the software on the system and automatically approve any prompts, bear in mind that while the AMI's are updated fairly regularily you will need to maintain updates yourself once you use one


## Elastic Load Balancer

**An Elastic Load Balancer helps us balance load across multiple different servers**, for instance if we had three seperate servers to help handle website traffic and we wanted to spread traffic from the internet equally accross them. *The reason for doing this is so that you don't get one server being overwhelmed with requests* or need to provision a single super machine to be able to handle all of the requests

There are three main types of load-balancer:
* Application Load Balancer - OSI Layer 7 (Application Network Layer), **can make clever descisions** about application level traffic *e.g. Do packets contain content bound for the ordering system? Send it there instead*, they're **built for load-balancing HTTP and HTTPS traffic**
* Network Load Balancer - OSI Layer 4 (Transport Layer), dumber than the application load balancer and can't make as smart decisions because it doesn't have the information **but it can do things very quickly** however its also **AWS's most expensive load balancer** but its typically what you would use if latency or performance is critical to you, **network Load Balancers can handle millions of requests per second**
* Classic Load Balancer - Not Reccomended to use, **the exam tests you mostly based on classic load balancers, even though AWS recccomend you don't use them** you can load balance on HTTP/S traffic and **can hook into layer 7 specific features (e.g. X-Forwarded), or use strict layer 4 years for load balancing TCP**, however the Layer 7 stuff you can do in this isn't anywhere near as complex or fast as the dedicated Application Load Balancer

If your application or what you have sitting behind the load-balancer stops responding or working **the load-balancer itself will respond with 504 Gateway Timeout**, if you see this your application behind has gone bang

If you have an application sitting behind a load-balancer, it recieves the IP address that it's called with which will be the IP or the load-balancer, **if you need the actual IP address of the entity that called the load-balancer its passed in the X-Forwarded-For header**

## Route53 Lab

**Route53 is Amazons Domain Name Service** its name comes from the port that DNS queries use, 53. *It allows you to map domain names to AWS services* such as EC2 Instances, Load balancers and S3 Buckets, you're able to buy domain names from within this service because *AWS operates its own domain registry*

### To buy a domain in Route53
1. Go to the Route53 dashboard underneath "Networking & Content Delivery"
2. Click "Get Started Now" underneath DNS management if you've not previously registered or worked with Route53
3. Click the "Registered Domains" on the sidebar to the left
4. Click "Register Domain" at the top, if you have an existing domain you want to transfer from a different domain registrar you can do that with the button to the right
5. Select what Top Level Domain (TLD) you want e.g. .com/.co.uk etc. and check for the availability of your desired domain, once you've found one thats available click continue



## CLI Demo

## EC2 with S3 Role Lab

## RDS 101

## RDS Lab

## RDS Multi-AZ & Read Replicas

## Elasticache 101

## Summary